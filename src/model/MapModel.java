package model;

import infra.GameConfig;

/**
 * 地图模型类
 * 负责存储关卡数据，并将 int[][] 数组解析为游戏引擎可用的 Tile[][] 对象矩阵
 */
public class MapModel {

    // 存储转换后的 Tile 对象，供物理引擎使用
    private Tile[][] tiles;

    // --- 构造函数 ---
    // 传入 int[][] 数组，自动解析为 Tile[][]
    public MapModel(int[][] levelData) {
        parseLevelData(levelData);
    }

    /**
     * 核心解析逻辑：把数字地图变成对象地图
     */
    private void parseLevelData(int[][] data) {
        // 初始化数组
        tiles = new Tile[GameConfig.MAP_ROWS][GameConfig.MAP_COLS];

        for (int r = 0; r < GameConfig.MAP_ROWS; r++) {
            for (int c = 0; c < GameConfig.MAP_COLS; c++) {

                int typeCode = 0; // 默认为空地

                // 防御性编程：防止数组越界导致崩溃
                if (r < data.length && c < data[r].length) {
                    typeCode = data[r][c];
                }

                TileType type;
                switch (typeCode) {
                    case GameConfig.TILE_BRICK: type = TileType.BRICK; break;
                    case GameConfig.TILE_STONE: type = TileType.STONE; break;
                    case GameConfig.TILE_WATER: type = TileType.WATER; break;
                    case GameConfig.TILE_GRASS: type = TileType.GRASS; break;
                    default: type = TileType.EMPTY; break;
                }

                // 创建 Tile 对象
                tiles[r][c] = new Tile(r, c, type);
            }
        }
    }

    // 获取解析后的 Tile 矩阵
    public Tile[][] getTiles() {
        return tiles;
    }

    // --- 关卡数据 (LEVEL_1) ---
    public static final int[][] LEVEL_1 = {
            // 第0-1行
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 4, 0, 0, 2, 2},
            {2, 2, 2, 2, 0, 0, 3, 0, 0, 2, 2, 0, 0, 0, 0, 2, 2, 2, 2, 0, 0, 4, 4, 0, 0, 0, 4, 0, 0, 0},
            {2, 2, 2, 2, 0, 0, 3, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 4, 4, 0, 0, 0, 0, 4, 0, 0},
            {0, 0, 2, 2, 0, 0, 3, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 2, 2, 1, 1, 4, 4, 0, 0, 0},
            {0, 0, 2, 2, 0, 0, 3, 0, 0, 2, 2, 2, 2, 2, 2, 0, 0, 4, 4, 0, 0, 2, 2, 1, 1, 4, 4, 0, 1, 1},
            {0, 0, 2, 2, 0, 0, 3, 0, 0, 2, 2, 2, 2, 2, 2, 0, 0, 4, 4, 0, 0, 2, 2, 0, 0, 0, 0, 0, 1, 1},
            {0, 0, 2, 2, 0, 0, 3, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 1, 1, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            // 第9行：中央通道
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            // 第10-12行
            {4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 4},
            {4, 4, 2, 2, 2, 2, 0, 0, 0, 2, 2, 1, 1, 0, 0, 4, 4, 4, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 4, 4},
            {4, 4, 2, 2, 2, 2, 4, 4, 4, 2, 2, 1, 1, 0, 0, 4, 0, 4, 0, 0, 1, 1, 0, 0, 0, 0, 2, 2, 2, 2},
            {0, 0, 0, 0, 2, 2, 4, 4, 4, 2, 2, 4, 4, 0, 0, 4, 4, 4, 0, 0, 2, 2, 0, 0, 0, 0, 2, 2, 0, 0},
            {0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 4, 4, 0, 0, 3, 3, 3, 0, 0, 2, 2, 0, 0, 0, 0, 2, 2, 0, 0},
            {0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 4, 4, 0, 0, 1, 1, 1, 0, 0, 2, 2, 1, 1, 1, 1, 2, 2, 0, 0},
            {0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 2, 2, 0, 0, 1, 0, 1, 0, 0, 2, 2, 0, 0, 1, 1, 2, 2, 0, 0},
            {0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 2, 2, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 2, 2, 0, 0},
            {4, 4, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 1, 1, 3, 3, 3, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 0, 0},
            {4, 4, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 1, 1, 3, 0, 3, 4, 4, 4, 4, 4, 4, 1, 1, 1, 1, 0, 0},
            {0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 4, 4},
            {0, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 3, 0, 3, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 4, 4}
    };
}